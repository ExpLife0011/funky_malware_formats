#pragma once
#include <Windows.h>

namespace lotus {
	typedef enum {
		NO_TYPE = 0,
		RELOC_TYPE = 1,
		EP_TYPE = 2,
		IMPORT_TYPE = 3
	} record_t;

	typedef struct
	{
		DWORD prolog;
		DWORD xor_val2;
		DWORD xor_val1;
		DWORD code_size;
	} header1_t;

	typedef struct
	{
		DWORD prolog;
		DWORD iat_size;
	} header2_t;

	typedef struct
	{
		DWORD counter; //TODO: check what it really is
		DWORD dll_rva;
		DWORD func_rva;
		DWORD iat_rva;
	} import_t;

	typedef struct {
		DWORD reloc_field;
	} reloc_t;

	typedef struct {
		DWORD count;
		DWORD entry_rva;
		DWORD name_rva; //TODO: check what it really is
	} entry_point_t;

	bool decode_file(IN OUT BYTE* content, IN size_t content_size);
	header1_t* get_hdr1(BYTE* content, size_t content_size);
	header2_t* get_hdr2(BYTE* content, size_t content_size);
	DWORD* get_records(BYTE* content, size_t content_size);
}; //namespace lotus

